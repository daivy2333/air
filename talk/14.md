å¥½ï¼Œè¿™ä¸ª PIR å·²ç»**ä¿¡æ¯è¶³å¤Ÿå®Œæ•´**äº†ï¼Œå¯ä»¥ç›´æ¥åœ¨å®ƒä¹‹ä¸Šåš**æ¥å£å±‚è®¾è®¡**ï¼Œè€Œä¸”æˆ‘ä¼šä¸¥æ ¼éµå®ˆä½ å‰é¢å¼ºè°ƒçš„çº¦æŸï¼š

> âŒ ä¸æ”¹æ­£å‘è§„èŒƒ
> âŒ ä¸æ”¹é€†å‘è§„èŒƒ
> âŒ ä¸åŠ¨å·²æœ‰ analyzer / reconstruct / writer çš„è¯­ä¹‰
> âœ… åªåš**è°ƒç”¨æ¥å£ä¸ç¼–æ’å±‚è®¾è®¡**

ä¸‹é¢æˆ‘ä¼šæŠŠç­”æ¡ˆåˆ†æˆ **â€œæ€ä¹ˆçœ‹ â†’ æ€ä¹ˆæ¥ â†’ æ€ä¹ˆç”¨â€ ä¸‰ä¸ªå±‚çº§**ï¼Œæœ€åç»™ä½ ä¸€ä¸ª**å¯ç›´æ¥è½åœ°çš„æ¥å£æ–¹æ¡ˆ**ã€‚

---

## ä¸€ã€å…ˆç»™ä½ ä¸€å¥ç»“è®ºï¼ˆé‡è¦ï¼‰

> **AIR é¡¹ç›®å·²ç»å¤©ç„¶åˆ†æˆä¸¤ä¸ªâ€œå¼•æ“ + ä¸€ä¸ªä¸­ç«‹ IRâ€**
> ä½ ç°åœ¨ç¼ºçš„ä¸æ˜¯åŠŸèƒ½ï¼Œè€Œæ˜¯ä¸€ä¸ª**App Facadeï¼ˆåº”ç”¨å¤–è§‚å±‚ï¼‰**

è¿™ä¸ª Facade å±‚åªåšä¸‰ä»¶äº‹ï¼š

1. **é€‰æ‹©æ¨¡å¼**ï¼ˆforward / reverseï¼‰
2. **ç»„ç»‡è°ƒç”¨é“¾**
3. **ç»Ÿä¸€å¯¹å¤–æ¥å£ï¼ˆCLI / API / åç»­ GUIï¼‰**

---

## äºŒã€ä» PIR è§’åº¦çœ‹ï¼šä½ ç°åœ¨çš„çœŸå®æ¶æ„æ˜¯ä»€ä¹ˆ

### 1ï¸âƒ£ æ­£å‘ï¼ˆpirgenï¼‰å­ç³»ç»Ÿ

**å…¥å£èƒ½åŠ›å·²ç»éå¸¸æ¸…æ™°ï¼š**

```text
pirgen/
â”œâ”€ analyzers/        â† å¤šè¯­è¨€ â†’ Unit / Symbol
â”œâ”€ core/
â”‚  â”œâ”€ project_model
â”‚  â”œâ”€ pir_builder    â† â­ æ­£å‘æ ¸å¿ƒ
â”‚  â”œâ”€ dep_canon
â”‚  â””â”€ profile_canon
â””â”€ pirgen.py         â† entry=true
```

**PIR é‡Œå·²ç»ç»™å‡ºæ˜ç¡®ä¸»å…¥å£ï¼š**

```
discover_source_files:u48
scan_project:u48
resolve_dependencies:u48
main:u48 entry=true
```

ğŸ‘‰ ç»“è®ºï¼š
**æ­£å‘çš„â€œæœ€å°ç¨³å®šè°ƒç”¨é¢â€å·²ç»å­˜åœ¨**ï¼Œä¸éœ€è¦ç¢°å†…éƒ¨ã€‚

---

### 2ï¸âƒ£ é€†å‘ï¼ˆpir-reconstructorï¼‰å­ç³»ç»Ÿ

ä½ è¿™è¾¹å…¶å®æ›´æˆç†Ÿï¼š

```text
reconstruct/
â”œâ”€ structure
â”œâ”€ interface
â”œâ”€ relations
â”œâ”€ documentation
â”œâ”€ enrichment
â”œâ”€ audit
â””â”€ pipeline.py   â† â­ ReconstructionPipeline
```

PIR ä¸­æ˜ç¡®æŒ‡å‡ºï¼š

```
ReconstructionPipeline:u28 class
emit_graphviz:u32
emit_pipeline_graph:u33
emit_module_graph:u34
emit_arch_graph:u37
emit_mermaid:u35
emit_plantuml:u38
```

ğŸ‘‰ ç»“è®ºï¼š
**é€†å‘å·²ç»æ˜¯â€œåˆ†å±‚æµæ°´çº¿ + å¤š writerâ€ç»“æ„**
éå¸¸é€‚åˆè¢« App å±‚è°ƒåº¦

---

### 3ï¸âƒ£ ä¸­ç«‹æ ¸å¿ƒï¼šPIR AST / Model

å…³é”®ç‚¹åœ¨è¿™é‡Œï¼š

```
Unit / Symbol / Dependency / PIRAST
```

å®ƒä»¬**åŒæ—¶è¢«æ­£å‘å’Œé€†å‘ä¾èµ–**ï¼Œæ˜¯å¤©ç„¶çš„ **åè®®å±‚ï¼ˆContractï¼‰**

---

## ä¸‰ã€ä½ çœŸæ­£éœ€è¦çš„ï¼šAIR App è°ƒç”¨æ¥å£è®¾è®¡

### æ ¸å¿ƒæ€æƒ³ï¼ˆä¸€å¥è¯ï¼‰

> **App å±‚åªåš orchestrationï¼Œä¸åšè¯­ä¹‰åˆ¤æ–­**

---

## å››ã€æ¨èçš„è°ƒç”¨æ¥å£åˆ†å±‚ï¼ˆéå¸¸å…³é”®ï¼‰

### ğŸ”¹ Layer 0ï¼šEngine å±‚ï¼ˆä½ å·²æœ‰ï¼‰

| å­ç³»ç»Ÿ               | è§’è‰²     |
| ----------------- | ------ |
| pirgen            | æ­£å‘åˆ†æå¼•æ“ |
| pir-reconstructor | é€†å‘é‡æ„å¼•æ“ |

ğŸ‘‰ **å†»ç»“ï¼Œä¸ç¢°**

---

### ğŸ”¹ Layer 1ï¼šService å±‚ï¼ˆæ–°å¢ï¼Œè–„ï¼‰

è¿™æ˜¯ä½ ç°åœ¨ç¼ºçš„ï¼Œä½†éå¸¸å°ã€‚

#### `services/forward.py`

```python
from pirgen.pirgen import main as pirgen_main

def run_forward(
    source_path: str,
    out: str | None = None,
    profile: str | None = None,
):
    return pirgen_main(
        source_path=source_path,
        output=out,
        profile=profile,
    )
```

#### `services/reverse.py`

```python
from pir_reconstructor.reconstruct.pipeline import ReconstructionPipeline
from pir_reconstructor.writers import (
    graphviz, mermaid, plantuml
)

def run_reverse(pir_path: str, format: str):
    pipeline = ReconstructionPipeline.from_pir(pir_path)

    if format == "graphviz":
        return graphviz.emit_graphviz(pipeline)
    if format == "pipeline":
        return graphviz.emit_pipeline_graph(pipeline)
    if format == "module":
        return graphviz.emit_module_graph(pipeline)
    if format == "arch":
        return graphviz.emit_arch_graph(pipeline)
    if format == "mermaid":
        return mermaid.emit_mermaid(pipeline)
    if format == "plantuml":
        return plantuml.emit_plantuml(pipeline)

    raise ValueError(f"unknown format: {format}")
```

ğŸ“Œ æ³¨æ„ï¼š

* **æ²¡æœ‰æ–°è¯­ä¹‰**
* åªæ˜¯æŠŠå·²æœ‰èƒ½åŠ›â€œå‘½å + å°è£…â€

---

## äº”ã€æœ€ç»ˆä½ è¦çš„ï¼šç»Ÿä¸€ App æ¥å£ï¼ˆé‡ç‚¹ï¼‰

### `app.py`ï¼ˆä½ è¯´çš„â€œé›†ä¸­æ­£å‘å’Œé€†å‘çš„åœ°æ–¹â€ï¼‰

```python
def main():
    import argparse

    parser = argparse.ArgumentParser(prog="air")
    sub = parser.add_subparsers(dest="cmd", required=True)

    # æ­£å‘
    fwd = sub.add_parser("forward")
    fwd.add_argument("src")
    fwd.add_argument("-o", "--out")
    fwd.add_argument("--profile")

    # é€†å‘
    rev = sub.add_parser("reverse")
    rev.add_argument("pir")
    rev.add_argument(
        "--format",
        choices=[
            "graphviz",
            "pipeline",
            "module",
            "arch",
            "mermaid",
            "plantuml",
        ],
        default="graphviz",
    )

    args = parser.parse_args()

    if args.cmd == "forward":
        from air.services.forward import run_forward
        run_forward(args.src, args.out, args.profile)

    elif args.cmd == "reverse":
        from air.services.reverse import run_reverse
        run_reverse(args.pir, args.format)
```

---

## å…­ã€ä½¿ç”¨æ–¹å¼ï¼ˆä½ æœ€ç»ˆå¾—åˆ°çš„ä½“éªŒï¼‰

```bash
air forward ./my_project
air reverse my_project.pir --format arch
air reverse my_project.pir --format pipeline
```

âœ” ä¸è¿›ä¸åŒç›®å½•
âœ” ä¸åŒºåˆ† pirgen / reconstructor
âœ” å¯¹ç”¨æˆ·åªæœ‰ä¸€ä¸ª â€œAIRâ€


