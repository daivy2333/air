

> ã€Œå½“å‰é¡¹ç›®å†…å¯ç”¨ã€
> â¡ï¸ã€Œç³»ç»Ÿç¯å¢ƒä»»æ„ä½ç½®å¯ç”¨ï¼š`air forward â€¦`ã€

ä¸€æ­¥ä¸€æ­¥æ¥ã€‚

---

## ä¸€å¥è¯ç»“è®ºï¼ˆå…ˆç»™ä½ å®šå¿ƒä¸¸ï¼‰

> **ä½ åªéœ€è¦æŠŠ AIR å˜æˆä¸€ä¸ªâ€œå¯å®‰è£…çš„ Python åŒ…â€ï¼Œå¹¶å£°æ˜ä¸€ä¸ª console script**

æ ¸å¿ƒæ‰‹æ®µåªæœ‰ä¸‰ä¸ªå­—ï¼š

> **pyproject.toml + entry point**

---

## ä¸€ã€ä½ å½“å‰é¡¹ç›®å·²ç»æ»¡è¶³çš„æ¡ä»¶ï¼ˆéå¸¸é‡è¦ï¼‰

ä½ ç°åœ¨å·²ç»æœ‰ï¼š

âœ… å•ä¸€ç»Ÿä¸€å…¥å£ï¼š`air/app.py`
âœ… ç¨³å®š CLI æ¥å£ï¼š`main()`
âœ… forward / reverse è§£è€¦
âœ… æ²¡æœ‰ç¡¬ç¼–ç  cwd
âœ… PIR / reconstructor éƒ½æ˜¯åº“åŒ–è°ƒç”¨

ğŸ‘‰ è¯´æ˜ï¼š
**ä½ å·²ç»å…·å¤‡å‘å¸ƒ CLI å·¥å…·çš„å…¨éƒ¨æŠ€æœ¯æ¡ä»¶**

---

## äºŒã€æ ‡å‡†åšæ³•ï¼ˆæ¨èï¼‰ï¼šç”¨ pyproject.toml å®‰è£…ä¸ºå‘½ä»¤è¡Œå·¥å…·

### 1ï¸âƒ£ é¡¹ç›®ç»“æ„ï¼ˆåªéœ€è¦æå°è°ƒæ•´ï¼‰

æ¨èä½ æŠŠ `air/` ä½œä¸º**é¡¶çº§åŒ…ç›®å½•**ï¼š

```text
air/
â”œâ”€ air/
â”‚  â”œâ”€ __init__.py
â”‚  â”œâ”€ app.py          â† ä½ ç°åœ¨è¿™ä¸ª
â”‚  â”œâ”€ services/
â”‚  â”‚  â”œâ”€ forward.py
â”‚  â”‚  â””â”€ reverse.py
â”‚
â”œâ”€ pirgen/
â”œâ”€ pir-reconstructor/
â”œâ”€ pyproject.toml
â”œâ”€ README.md
```

> âš ï¸ æ³¨æ„ï¼š
> `app.py` å¿…é¡»åœ¨ **package ç›®å½•é‡Œ**ï¼Œä¸æ˜¯è£¸æ–‡ä»¶

---

### 2ï¸âƒ£ ä¿®æ”¹ app.pyï¼ˆåªéœ€è¦ 1 å¤„ï¼‰

**åˆ é™¤è¿™æ®µ hackï¼ˆå¿…é¡»ï¼‰**ï¼š

```python
# âŒ ä¸å†éœ€è¦
services_path = Path(__file__).parent / "services"
sys.path.insert(0, str(services_path))
```

ç„¶åæ”¹æˆ**æ ‡å‡†åŒ…å†… import**ï¼š

```python
from air.services.forward import run_forward
from air.services.reverse import run_reverse
```

ğŸ“Œ è¿™æ˜¯ä¸ºäº† **pip å®‰è£…å import æ­£å¸¸**

---

## ä¸‰ã€æ ¸å¿ƒï¼šå†™ pyproject.tomlï¼ˆå…³é”®ï¼‰

è¿™æ˜¯è®© `air` å˜æˆç³»ç»Ÿå‘½ä»¤çš„**æ ¸å¿ƒæ–‡ä»¶**ã€‚

### `pyproject.toml`

```toml
[build-system]
requires = ["setuptools>=61.0"]
build-backend = "setuptools.build_meta"

[project]
name = "air-tool"
version = "0.1.0"
description = "AIR - Application Interface Center for PIR forward and reverse engineering"
authors = [
    { name = "daivy", email = "your@email.com" }
]
readme = "README.md"
requires-python = ">=3.9"
license = { text = "MIT" }

dependencies = [
    # å¦‚æœ pirgen / pir-reconstructor ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨è¿™é‡Œåˆ—
]

[project.scripts]
air = "air.app:main"
```

### è¿™ä¸€è¡Œçš„æ„ä¹‰ï¼ˆéå¸¸é‡è¦ï¼‰

```toml
air = "air.app:main"
```

æ„æ€æ˜¯ï¼š

> å½“ç”¨æˆ·è¾“å…¥ `air`
> ğŸ‘‰ Python æ‰§è¡Œ `air/app.py` é‡Œçš„ `main()`

---

## å››ã€å®‰è£…æ–¹å¼ï¼ˆå¼€å‘æœŸ & å‘å¸ƒæœŸï¼‰

### æ–¹å¼ä¸€ï¼šå¼€å‘æœŸï¼ˆå¼ºçƒˆæ¨èï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
pip install -e .
```

æ•ˆæœï¼š

* âœ” ç«‹åˆ»ç”Ÿæˆ `air` å‘½ä»¤
* âœ” ä»£ç æ”¹åŠ¨ç«‹å³ç”Ÿæ•ˆ
* âœ” ä¸æ±¡æŸ“ç³»ç»Ÿï¼ˆå¯å¸è½½ï¼‰

éªŒè¯ï¼š

```bash
air --help
air forward ./road
air reverse ./road.pir destination
```

---

### æ–¹å¼äºŒï¼šæ­£å¼å®‰è£…ï¼ˆç»™åˆ«äººç”¨ï¼‰

```bash
pip install .
```


## äº”ã€ä½ ç°åœ¨çš„ CLI è®¾è®¡æ˜¯å¦â€œåˆæ ¼â€ï¼Ÿç»“è®ºï¼šéå¸¸å¥½

æˆ‘ä»**å·¥å…·è®¾è®¡è§’åº¦**ç»™ä½ ä¸€ä¸ªè¯„ä»·ï¼š

### âœ… åšå¾—éå¸¸å¯¹çš„åœ°æ–¹

* forward / reverse **æ˜¯åŠ¨è¯ï¼Œä¸æ˜¯åè¯**
* å‚æ•°æ˜¯â€œä¸šåŠ¡è¯­ä¹‰â€ï¼Œä¸æ˜¯å®ç°ç»†èŠ‚
* æ²¡æš´éœ² pirgen / reconstructor çš„å­˜åœ¨
* output_dir / project_root è®¾è®¡åˆç†
* validate-only æ˜¯éå¸¸ä¸“ä¸šçš„è®¾è®¡

> è¿™å·²ç»æ˜¯**å·¥ä¸šçº§ CLI**çš„é£æ ¼äº†

---

## å…­ã€è¿›é˜¶ï¼ˆéå¿…é¡»ï¼Œä½†ä½ æœªæ¥ä¸€å®šä¼šç”¨ï¼‰

### 1ï¸âƒ£ æ”¯æŒ `python -m air`

åœ¨ `air/__main__.py` åŠ ä¸€å¥ï¼š

```python
from .app import main

if __name__ == "__main__":
    main()
```

ç„¶åä½ å¯ä»¥ï¼š

```bash
python -m air forward ./road
```

---

### 2ï¸âƒ£ ç»™ forward / reverse é¢„ç•™ API ç¨³å®šå±‚ï¼ˆä½ å·²ç»åšäº†ï¼‰

```python
run_forward(...)
run_reverse(...)
```
