# 测试项目集合说明

本项目集合包含多种语言的测试项目，用于验证和测试代码解析器的功能。

## 项目列表

### 1. Python 测试项目
**目录**: `python_project/`

**功能**:
- 计算器类实现
- 工具函数模块
- 基本的函数调用和类定义

**测试重点**:
- 类定义和方法的提取
- 函数签名提取
- 模块导入分析
- 调用链分析

---

### 2. C 测试项目
**目录**: `c_project/`

**功能**:
- 计算器结构体和函数
- 工具函数实现
- 头文件和源文件分离

**测试重点**:
- 结构体定义提取
- 函数签名提取
- 指针操作分析
- 头文件和实现文件的关系

---

### 3. C++ 测试项目
**目录**: `cpp_project/`

**功能**:
- 面向对象的计算器类
- 模板和命名空间
- 异常处理

**测试重点**:
- 类定义和方法提取
- 构造函数/析构函数识别
- 模板函数处理
- 异常语句分析

---

### 4. Rust 测试项目
**目录**: `rust_project/`

**功能**:
- 结构体和 impl 块
- 模块系统
- 所有权和借用示例
- Result 类型使用

**测试重点**:
- 结构体字段提取
- impl 块和方法识别
- trait 和泛型处理
- 错误处理（Result 类型）

---

### 5. 汇编测试项目
**目录**: `asm_project/`

**功能**:
- 系统启动代码
- 硬件初始化
- 中断处理框架
- 主循环实现

**测试重点**:
- 标签和符号提取
- 指令识别
- 控制流分析
- 数据段定义

---

### 6. 交叉语言项目
**目录**: `cross_project/`

**功能**:
- C++ 主程序调用 C 和 Rust 模块
- 多语言 FFI（外部函数接口）
- 混合语言调用链

**测试重点**:
- 跨语言函数调用分析
- 不同语言的符号解析
- FFI 接口识别
- 混合项目的依赖关系

---

### 7. OS 内核项目
**目录**: `os_project/`

**功能**:
- 内核启动代码（汇编）
- 内存管理模块（C）
- 任务调度器（C）
- 页表管理
- 任务控制块

**测试重点**:
- 汇编和 C 混合代码
- 复杂的结构体定义
- 跨模块调用链
- 系统级代码分析
- 位域结构体处理

---

## 测试用例说明

每个项目都包含完整的测试用例（test.pcr），覆盖以下视图：

1. **exist 视图**: 验证符号/单元是否存在
2. **definition 视图**: 获取完整定义
3. **api 视图**: 提取函数/方法签名
4. **impl 视图**: 获取实现详情
5. **summary 视图**: 获取结构化摘要
6. **callchain 视图**: 分析调用链

## 使用方法

### 运行单个项目测试

```bash
# 以 Python 项目为例
cd python_project
pcegen --pir project.pir --pcr test.pcr --source-dir .
```

### 批量测试所有项目

```bash
# 可以编写脚本批量运行所有测试
for dir in python_project c_project cpp_project rust_project asm_project cross_project os_project; do
    echo "Testing $dir..."
    cd $dir
    pcegen --pir project.pir --pcr test.pcr --source-dir .
    cd ..
done
```

## 预期结果

### Python 项目
- ✅ 所有视图应正常工作
- ✅ 类和方法提取完整
- ✅ 调用链准确

### C 项目
- ⚠️ 结构体定义应完整
- ⚠️ 函数签名需要改进
- ⚠️ 调用链需要优化

### C++ 项目
- ❌ 需要修复正则表达式错误
- ❌ API 视图需要实现
- ❌ 类定义提取需要完善

### Rust 项目
- ⚠️ API 视图需要实现
- ⚠️ 结构体字段提取不完整
- ⚠️ 调用链分析需要改进

### 汇编项目
- ⚠️ 标签提取应工作
- ⚠️ 控制流分析需要实现
- ⚠️ 汇编指令识别需要完善

### 交叉项目
- ❌ 跨语言调用链需要实现
- ❌ FFI 接口识别需要改进
- ❌ 多语言符号解析需要完善

### OS 项目
- ❌ 复杂结构体需要完整支持
- ❌ 位域结构体需要正确解析
- ❌ 跨模块调用链需要实现

## 已知问题和修复计划

### 高优先级问题
1. **C/C++ 解析器初始化错误**
   - 位置: analyzers/c.py, analyzers/cpp.py
   - 问题: 正则表达式语法错误
   - 修复: 检查并修复第179行附近的正则表达式

2. **API 视图完全失败**
   - 影响: C/C++/Rust 项目的 API 提取
   - 修复: 实现函数签名提取功能

### 中优先级问题
3. **结构体/枚举字段提取不完整**
   - 影响: Rust 和 C++ 项目的结构体分析
   - 修复: 完善字段提取逻辑

4. **调用链分析质量差**
   - 影响: 所有项目的调用关系分析
   - 修复: 改进函数调用识别，避免误识别表达式

### 低优先级问题
5. **汇编分析功能缺失**
   - 影响: 汇编项目的分析
   - 修复: 实现标签提取和控制流分析

6. **跨语言调用链未实现**
   - 影响: 交叉项目的依赖分析
   - 修复: 实现跨模块调用链追踪

## 贡献指南

如需添加新的测试项目：

1. 在对应目录创建源代码文件
2. 创建 project.pir 文件描述项目结构
3. 创建 test.pcr 文件定义测试用例
4. 在本文档中添加项目说明
5. 更新已知问题和修复计划

## 许可证

本测试项目集合用于测试和验证代码解析器功能。
